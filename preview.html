<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Preview Spreadsheet</title>
  <style>
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;background:#000}
    
    /* TOP BAR - Hanya tombol back */
    .topbar{
      height:56px;
      background:#0f0f0f;
      color:#fff;
      display:flex;
      align-items:center;
      gap:12px;
      padding:0 12px;
      box-shadow:0 2px 6px rgba(0,0,0,.6);
      position:relative;
      z-index:10;
    }
    
    .back{
      background:#00e676;
      border:0;
      padding:8px 12px;
      border-radius:8px;
      font-weight:700;
      cursor:pointer;
      color:#000;
      font-size:14px;
      transition:background 0.3s;
      display: flex;
      align-items: center;
      gap: 4px;
    }
    
    .back:hover{
      background:#00c853;
    }
    
    .back-arrow {
      font-size: 16px;
    }
    
    .page-title {
      color:#fff;
      font-weight:600;
      font-size:16px;
      margin-left: 8px;
    }
    
    /* Container untuk iframe */
    .iframewrap{
      position:absolute;
      top:56px;
      right:0;
      left:0;
      bottom:0;
    }
    
    .iframewrap iframe{
      width:100%;
      height:100%;
      border:0;
    }
    
    /* Warning/Error messages */
    .warning{
      padding:20px;
      color:#fff;
      background:#ff7043;
      text-align:center;
      font-size:16px;
      margin:20px;
      border-radius:8px;
    }
    
    /* Responsive untuk mobile */
    @media(max-width:600px){
      .topbar{
        height:52px;
        padding:0 10px;
      }
      
      .back{
        padding:6px 10px;
        font-size:13px;
      }
      
      .page-title {
        font-size:14px;
      }
      
      .iframewrap{
        top:52px;
      }
    }
  </style>
</head>
<body>
   <!-- GUARD LOGIN: CEK LOCALSTORAGE -->
    <script>
      (function () {
        const isLoggedIn = localStorage.getItem("isLoggedIn");
        if (isLoggedIn !== "true") {
          // Kalau belum login, paksa balik ke halaman login (index.html)
          window.location.href = "/";
        }
      })();
    </script>
  <div class="topbar">
    <button class="back" id="backBtn">
      <span class="back-arrow">‚Üê</span>
      <span>Back</span>
    </button>
    <div class="page-title">Preview Spreadsheet</div>
  </div>

  <div class="iframewrap" id="frameBox">
    <!-- iframe di-set via JS -->
  </div>

  <script>
    function qs(name) {
      const params = new URLSearchParams(location.search);
      return params.get(name);
    }
    
    const encoded = qs('u');
    const frameBox = document.getElementById('frameBox');

    if (!encoded) {
      frameBox.innerHTML = '<div class="warning">Tidak ada file yang diberikan. Kembali ke halaman sebelumnya.</div>';
    } else {
      try {
        const pubUrl = decodeURIComponent(encoded);
        
        
        if (!pubUrl.startsWith('https://')) {
          frameBox.innerHTML = '<div class="warning">URL tidak valid atau tidak aman.</div>';
        } else {
         
          const ifr = document.createElement('iframe');
          ifr.src = pubUrl;
          ifr.loading = 'lazy';
          frameBox.appendChild(ifr);
          
          
          ifr.onerror = function() {
            frameBox.innerHTML = `
              <div class="warning">
                <p>Gagal memuat spreadsheet.</p>
                <p>Mungkin spreadsheet tidak tersedia atau tidak di-publikasikan dengan benar.</p>
              </div>`;
          };
        }
      } catch(e) {
        frameBox.innerHTML = '<div class="warning">URL tidak dapat dibuka.</div>';
      }
    }

  
    document.getElementById('backBtn').addEventListener('click', () => {
      
      if (history.length > 1) {
        history.back();
      } else {
        location.href = 'excel.html';
      }
    });

   
    document.addEventListener('keydown', function(e) {
      if (e.key === 'Escape') {
        document.getElementById('backBtn').click();
      }
    });
  </script>
</body>
</html>